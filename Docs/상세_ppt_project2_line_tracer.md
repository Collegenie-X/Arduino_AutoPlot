# 🟡 Project 2: 라인 트레이서 (AutoPlot)

---

## Slide 1: 표지

### 🛣️ 라인 트레이서 (AutoPlot)
**IR 센서 기반 경로 추종 시스템**

- 실제 자율주행 연계: 차선 유지 보조 (LKAS)
- 난이도: ★★☆☆☆ (초급)
- 소요 시간: 3시간

---

## Slide 2: 학습 목표

### 🎯 이 프로젝트를 마치면...

1. **IR 센서**의 동작 원리를 이해할 수 있다
2. **센서 캘리브레이션** 방법을 알 수 있다
3. **센서 조합 기반 의사결정**을 구현할 수 있다
4. **라인 이탈 복구** 알고리즘을 이해할 수 있다
5. 실제 **LKAS** 기술을 이해할 수 있다

---

## Slide 3: 실제 자율주행 연계

### 🚗 차선 유지 보조 시스템 (LKAS)

```
┌─────────────────────────────────────────────┐
│           실제 LKAS 시스템                  │
├─────────────────────────────────────────────┤
│                                             │
│   [전방 카메라] → [차선 인식 AI]            │
│         │              │                    │
│         ▼              ▼                    │
│   [이미지 분석] → [차선 위치 계산]          │
│                        │                    │
│                        ▼                    │
│              [조향각 결정] → [EPS 제어]     │
│                                             │
├─────────────────────────────────────────────┤
│           우리 프로젝트                      │
├─────────────────────────────────────────────┤
│                                             │
│   [IR 센서 3개] → [라인 감지]               │
│         │              │                    │
│         ▼              ▼                    │
│   [아날로그 값] → [임계값 비교]             │
│                        │                    │
│                        ▼                    │
│              [방향 결정] → [모터 제어]      │
│                                             │
└─────────────────────────────────────────────┘
```

**실제 사례**: 테슬라 오토파일럿, 현대 HDA, 차선 이탈 경고(LDW)

---

## Slide 4: IR 센서 동작 원리

### 💡 적외선 반사 감지

```
┌─────────────────────────────────────────────┐
│                                             │
│   IR 센서 구조                              │
│   ┌─────────────────────────┐              │
│   │  [발광부]    [수광부]   │              │
│   │     │           ▲      │              │
│   │     │           │      │              │
│   │     ▼           │      │              │
│   │  적외선 ─────→ 반사광   │              │
│   └─────────────────────────┘              │
│                                             │
│   흰색 표면 (반사 많음)                     │
│   ┌─────────────────────────┐              │
│   │  ░░░░░░░░░░░░░░░░░░░░░  │ → 낮은 값    │
│   │  ~200                   │   (200-300)  │
│   └─────────────────────────┘              │
│                                             │
│   검정 표면 (반사 적음)                     │
│   ┌─────────────────────────┐              │
│   │  ████████████████████   │ → 높은 값    │
│   │  ~900                   │   (800-950)  │
│   └─────────────────────────┘              │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 5: 센서 배치도

### 📍 3채널 IR 센서 배치

```
              전진 방향
                 ▲
                 │
    ┌────────────────────────┐
    │                        │
    │   ●        ●        ●  │  ← IR 센서
    │  LEFT   CENTER   RIGHT │
    │  (A0)    (A1)    (A2)  │
    │                        │
    │     ┌──────────┐       │
    │     │          │       │
    │  ◯  │  Arduino │  ◯    │  ← 바퀴
    │     │          │       │
    │     └──────────┘       │
    │                        │
    │  ◯                ◯    │  ← 바퀴
    │                        │
    └────────────────────────┘
```

---

## Slide 6: 핀 연결 다이어그램

### 🔌 아두이노 연결

```
        Arduino UNO
    ┌─────────────────┐
    │                 │
    │  A0 ←── LEFT    │  (왼쪽 센서)
    │  A1 ←── CENTER  │  (중앙 센서)
    │  A2 ←── RIGHT   │  (오른쪽 센서)
    │                 │
    │  D5 ──→ Motor1+ │  (오른쪽 전진)
    │  D6 ──→ Motor1- │  (오른쪽 후진)
    │                 │
    │  D11 ─→ Motor2+ │  (왼쪽 전진)
    │  D12 ─→ Motor2- │  (왼쪽 후진)
    │                 │
    │  D8 ──→ PIEZO   │  (부저)
    │                 │
    │  5V ──→ Sensor  │
    │  GND ─→ Sensor  │
    │                 │
    └─────────────────┘
```

---

## Slide 7: 캘리브레이션 과정

### 🔧 센서값 측정 및 임계값 설정

```
┌─────────────────────────────────────────────┐
│                                             │
│   Step 1: 흰색 바닥에서 측정                │
│   ┌─────────────────────────────────────┐  │
│   │ Serial Monitor:                     │  │
│   │ LEFT: 210 | CENTER: 195 | RIGHT: 220│  │
│   └─────────────────────────────────────┘  │
│                                             │
│   Step 2: 검정 라인에서 측정                │
│   ┌─────────────────────────────────────┐  │
│   │ Serial Monitor:                     │  │
│   │ LEFT: 890 | CENTER: 910 | RIGHT: 885│  │
│   └─────────────────────────────────────┘  │
│                                             │
│   Step 3: 임계값 계산                       │
│   ┌─────────────────────────────────────┐  │
│   │ 임계값 = (흰색 + 검정) / 2          │  │
│   │ LEFT: (210+890)/2 = 550             │  │
│   │ CENTER: (195+910)/2 = 552           │  │
│   │ RIGHT: (220+885)/2 = 552            │  │
│   │                                     │  │
│   │ → #define LINE_SENSOR 550           │  │
│   └─────────────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 8: 캘리브레이션 기록표

### 📝 학생용 측정 기록

| 센서 위치 | 핀 번호 | 흰색 값 | 검정 값 | 임계값 |
|-----------|---------|---------|---------|--------|
| 왼쪽 | A0 | _____ | _____ | _____ |
| 중앙 | A1 | _____ | _____ | _____ |
| 오른쪽 | A2 | _____ | _____ | _____ |

**계산 공식**: `임계값 = (흰색값 + 검정값) ÷ 2`

---

## Slide 9: 센서 조합별 상태

### 📊 8가지 센서 조합

```
┌─────────────────────────────────────────────┐
│                                             │
│   ○ = 흰색(미감지)    ● = 검정(감지)        │
│                                             │
│   ┌──────┬──────┬──────┬────────────────┐  │
│   │ LEFT │CENTER│RIGHT │     상태       │  │
│   ├──────┼──────┼──────┼────────────────┤  │
│   │  ○   │  ●   │  ○   │ 정상 주행      │  │
│   │  ●   │  ○   │  ○   │ 라인 왼쪽      │  │
│   │  ○   │  ○   │  ●   │ 라인 오른쪽    │  │
│   │  ●   │  ●   │  ○   │ 좌측 커브      │  │
│   │  ○   │  ●   │  ●   │ 우측 커브      │  │
│   │  ●   │  ●   │  ●   │ 종료/교차점    │  │
│   │  ○   │  ○   │  ○   │ 라인 이탈      │  │
│   │  ●   │  ○   │  ●   │ 예외 상황      │  │
│   └──────┴──────┴──────┴────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 10: 의사결정 테이블

### 🚦 센서 상태 → 동작 매핑

| 왼쪽 | 중앙 | 오른쪽 | 동작 | 설명 |
|:----:|:----:|:------:|------|------|
| ○ | ● | ○ | **전진** | 라인 위 정상 주행 |
| ● | ○ | ○ | **좌회전** | 라인이 왼쪽에 있음 |
| ○ | ○ | ● | **우회전** | 라인이 오른쪽에 있음 |
| ● | ● | ○ | **약한 좌회전** | 좌측 곡선 구간 |
| ○ | ● | ● | **약한 우회전** | 우측 곡선 구간 |
| ● | ● | ● | **정지** | 종료 또는 교차점 |
| ○ | ○ | ○ | **복구 시도** | 라인 이탈 상태 |

---

## Slide 11: 라인 트레이싱 순서도

### 🔄 기본 알고리즘 흐름

```
┌─────────────────────────────────────────────┐
│                                             │
│              [시작]                         │
│                │                            │
│                ▼                            │
│         [센서값 읽기]                       │
│    L=analogRead(A0)                        │
│    C=analogRead(A1)                        │
│    R=analogRead(A2)                        │
│                │                            │
│                ▼                            │
│        [임계값 비교]                        │
│                │                            │
│     ┌──────────┼──────────┐                │
│     │          │          │                │
│     ▼          ▼          ▼                │
│  [L감지]   [C감지]   [R감지]               │
│     │          │          │                │
│     ▼          ▼          ▼                │
│ [좌회전]   [전진]   [우회전]               │
│     │          │          │                │
│     └──────────┼──────────┘                │
│                │                            │
│                ▼                            │
│          [센서값 읽기]                      │
│                │                            │
│           (반복)                            │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 12: 핵심 코드 분석

### 💻 라인 트레이싱 코드

```arduino
#define LINE_SENSOR 850  // 캘리브레이션 값으로 수정!

void loop() {
    // 1. 센서값 읽기
    int left = analogRead(A0);
    int center = analogRead(A1);
    int right = analogRead(A2);
    
    // 2. 임계값 비교
    bool leftDetect = (left > LINE_SENSOR);
    bool centerDetect = (center > LINE_SENSOR);
    bool rightDetect = (right > LINE_SENSOR);
    
    // 3. 의사결정
    if (leftDetect && centerDetect && rightDetect) {
        Stop();  // 종료 라인
    }
    else if (centerDetect) {
        Forward();  // 직진
    }
    else if (leftDetect) {
        Leftward();  // 좌회전
    }
    else if (rightDetect) {
        Rightward();  // 우회전
    }
    else {
        Stop();  // 이탈 - 정지
    }
}
```

---

## Slide 13: 실제 LKAS 비교

### 🚗 우리 프로젝트 vs 실제 기술

```
┌─────────────────────────────────────────────┐
│                                             │
│   기능               실제 LKAS    우리      │
│   ─────────────────────────────────────────│
│   센서               카메라       IR 센서   │
│   처리               AI 딥러닝   임계값비교 │
│   차선 인식          영상 분석   반사광감지 │
│   조향 제어          EPS         DC 모터    │
│   속도 조절          엔진/제동   PWM        │
│   이탈 복구          자동 복귀   마지막방향 │
│   경고               시각/청각   부저       │
│                                             │
│   공통점: 센서 → 판단 → 제어 구조 동일     │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 14: 라인 이탈 복구 알고리즘

### 🔄 복구 전략

```
┌─────────────────────────────────────────────┐
│                                             │
│   [라인 이탈 감지]                          │
│   (모든 센서 미감지: ○○○)                  │
│          │                                  │
│          ▼                                  │
│   [마지막 방향 확인]                        │
│          │                                  │
│   ┌──────┼──────┐                          │
│   │      │      │                          │
│   ▼      ▼      ▼                          │
│ [-1]    [0]    [1]                         │
│ 좌회전  직진   우회전                       │
│   │      │      │                          │
│   ▼      ▼      ▼                          │
│ [계속   [후진  [계속                        │
│  좌회전] 탐색]  우회전]                     │
│   │      │      │                          │
│   └──────┼──────┘                          │
│          │                                  │
│          ▼                                  │
│   [센서 감지?] ── Yes ──→ [복구 성공]      │
│          │                                  │
│          No                                 │
│          │                                  │
│          ▼                                  │
│   [시도 횟수 > 5?] ── Yes ──→ [정지]       │
│          │                                  │
│          No                                 │
│          │                                  │
│          └──────→ (반복)                   │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 15: 복구 코드 구현

### 💻 라인 이탈 복구 코드

```arduino
// 전역 변수 추가
int lastDirection = 0;  // -1:좌, 0:직진, 1:우
int recoveryCount = 0;  // 복구 시도 횟수

void loop() {
    // ... 센서 읽기 코드 ...
    
    // 모두 미감지 = 라인 이탈
    if (!leftDetect && !centerDetect && !rightDetect) {
        recoveryCount++;
        
        if (recoveryCount > 5) {
            Stop();  // 복구 실패
            return;
        }
        
        // 마지막 방향으로 복구 시도
        if (lastDirection == -1) {
            Leftward();  // 계속 좌회전
        } else if (lastDirection == 1) {
            Rightward();  // 계속 우회전
        } else {
            Backward();  // 후진
            delay(300);
        }
    } else {
        recoveryCount = 0;  // 복구 성공
        
        // 정상 주행 시 방향 기록
        if (leftDetect) lastDirection = -1;
        if (rightDetect) lastDirection = 1;
        if (centerDetect && !leftDetect && !rightDetect) 
            lastDirection = 0;
    }
}
```

---

## Slide 16: 테스트 트랙 설계

### 🛤️ 단계별 트랙

```
┌─────────────────────────────────────────────┐
│                                             │
│   기본 트랙 (직선 + 완만한 곡선)            │
│   ┌───────────────────────────────────┐    │
│   │      ╭───────────────────╮        │    │
│   │      │                   │        │    │
│   │   S──┘                   └────G   │    │
│   │                                   │    │
│   └───────────────────────────────────┘    │
│                                             │
│   중급 트랙 (급커브)                        │
│   ┌───────────────────────────────────┐    │
│   │       ╭──╮         ╭──╮           │    │
│   │       │  │         │  │           │    │
│   │   S───┘  └─────────┘  └───G       │    │
│   │                                   │    │
│   └───────────────────────────────────┘    │
│                                             │
│   고급 트랙 (교차점 + 급커브)               │
│   ┌───────────────────────────────────┐    │
│   │     ╭──╮       ╭──╮               │    │
│   │     │  │       │  │               │    │
│   │   S─┼──┼───────┼──┼─G             │    │
│   │     │  │       │  │               │    │
│   │     ╰──╯       ╰──╯               │    │
│   └───────────────────────────────────────┘│
│                                             │
└─────────────────────────────────────────────┘
```

---

## Slide 17: 코드 수정 과제

### ✏️ 실습 1: 임계값 수정

**목표**: 캘리브레이션 결과 적용

```arduino
// 수정 전
#define LINE_SENSOR 850

// 수정 후 (캘리브레이션 결과)
#define LINE_SENSOR 550  // 자신의 측정값으로 변경
```

---

## Slide 18: 코드 수정 과제

### ✏️ 실습 2: 속도 최적화

**목표**: 안정적인 주행 속도 찾기

```arduino
// 수정 전
#define SPEED 130
#define LEFT_SPEED 150

// 테스트할 값들
// 직선 속도: 100, 130, 150, 180
// 회전 속도: 120, 150, 180

// 최적값 찾기:
// - 너무 빠르면: 커브에서 이탈
// - 너무 느리면: 반응 지연
```

---

## Slide 19: 테스트 체크리스트

### ✅ 기능 테스트

| 테스트 항목 | 성공 기준 | Pass |
|-------------|-----------|:----:|
| 센서 캘리브레이션 | 흰색/검정 구분 가능 | ☐ |
| 직선 구간 | 중앙 유지하며 주행 | ☐ |
| 완만한 좌커브 | 이탈 없이 통과 | ☐ |
| 완만한 우커브 | 이탈 없이 통과 | ☐ |
| 급커브 | 감속 후 통과 | ☐ |
| 종료 라인 (●●●) | 자동 정지 | ☐ |
| 라인 이탈 | 3초 내 복구 | ☐ |

---

## Slide 20: 트러블슈팅

### 🔧 자주 발생하는 문제

```
┌─────────────────────────────────────────────┐
│ 문제: 센서가 라인을 인식 못함               │
├─────────────────────────────────────────────┤
│ 원인                     해결 방법          │
│ ─────────────────────────────────────────── │
│ 임계값 부적절            캘리브레이션 재실행│
│ 센서 높이 문제           1-2cm 높이 조절    │
│ 라인 테이프 반사         검정 테이프 사용   │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ 문제: 커브에서 자주 이탈                    │
├─────────────────────────────────────────────┤
│ 원인                     해결 방법          │
│ ─────────────────────────────────────────── │
│ 속도 너무 빠름           SPEED 값 감소      │
│ 회전 속도 부족           LEFT_SPEED 증가    │
│ 센서 간격 문제           센서 위치 조절     │
└─────────────────────────────────────────────┘
```

---

## Slide 21: 확장 아이디어

### 💡 추가 도전 과제

1. **속도 가변 제어**: 직선에서 빠르게, 커브에서 느리게
2. **교차점 처리**: 특정 방향 우선 선택
3. **구간 카운팅**: 라인 횡단 횟수로 위치 파악
4. **음성 안내**: 커브 진입 시 "좌회전합니다"
5. **PID 제어**: 더 부드러운 주행

---

## Slide 22: 정리 및 다음 단계

### 📌 이번 프로젝트 요약

- ✅ IR 센서 동작 원리 이해
- ✅ 캘리브레이션 방법 습득
- ✅ 센서 조합 기반 의사결정 구현
- ✅ 라인 이탈 복구 알고리즘 이해
- ✅ 실제 LKAS 기술 연계

### ➡️ 다음 프로젝트

**🟠 Project 3: 장애물 피하기**
- 초음파 센서로 거리 측정
- 서보모터로 스캔
- 실제 AEB 기술 체험

---

*© 2025 라인 트레이서 프로젝트*

